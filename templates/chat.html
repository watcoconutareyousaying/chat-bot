<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dental Chatbot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">Dental Chatbot</div>
    <div class="chat-box" id="chat-box">
      <div class="message bot">Hello! How can I assist you with dental topics today?</div>
    </div>
    <div class="chat-input">
      <input type="text" id="user-input" placeholder="Type your question..." autocomplete="off" />
      <button id="send-btn">Send</button>
    </div>
  </div>

  <script>
    const sendBtn = document.getElementById('send-btn');
    const userInput = document.getElementById('user-input');
    const chatBox = document.getElementById('chat-box');

    function appendMessage(sender, text, isError = false) {
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${sender}` + (isError ? " error" : "");
      msgDiv.textContent = text;
      chatBox.appendChild(msgDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    sendBtn.addEventListener('click', async () => {
      const message = userInput.value.trim();
      if (message === "") return;

      appendMessage('user', message);
      userInput.value = "";

      try {
        const formData = new FormData();
        formData.append("msg", message);

        const response = await fetch("/get", {
          method: "POST",
          body: formData
        });

        const data = await response.text();

        // Detect error messages (starts with ⚠️ or similar)
        const isError = data.toLowerCase().includes("error");
        appendMessage('bot', data, isError);
      } catch (err) {
        appendMessage('bot', "⚠️ Error: Unable to connect to the server.", true);
      }
    });

    userInput.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        sendBtn.click();
      }
    });
  </script>
</body>
</html>
